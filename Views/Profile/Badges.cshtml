@model CookBook.ViewModels.UserBadgesViewModel
@{
    ViewData["Title"] = "Conquistas e N√≠vel";
}


<h1>@ViewData["Title"]</h1>
<hr />

@{
    double percent = 0;
    // Evita divis√£o por zero se o ExpToNextLevel for 0
    if (Model.ExpToNextLevel > 0) 
    {
        percent = ((double)Model.ExperiencePoints / Model.ExpToNextLevel) * 100;
        if (percent > 100) percent = 100; // Caso o usu√°rio tenha EXP suficiente para o pr√≥ximo n√≠vel
    }
    
    // EXP remanescente para o n√≠vel atual
    int expCurrentLevel = Model.Level == 1 ? 0 : CookBook.Services.GamificationService.GetExpToNextLevel(Model.Level - 1);
    int expProgress = Model.ExperiencePoints; // Aqui √© o EXP acumulado no n√≠vel atual
}

<div class="card p-4 mb-5 shadow-sm">
    <div class="d-flex align-items-center">
        @* üí° Espa√ßo para Imagem de Perfil (futuramente) *@
        <i class="fas fa-user-circle fa-4x text-primary me-4"></i>
        
        <div>
            <h2>@Model.UserName</h2>
            <p class="text-muted mb-0">N√≠vel Atual: <strong>@Model.Level</strong></p>
        </div>
    </div>
    
    <div class="mt-3">
        <label class="form-label">Progresso para o N√≠vel @(Model.Level + 1)</label>
        
        <div class="progress" style="height: 25px;">
            <div class="progress-bar progress-bar-striped bg-success" 
                 role="progressbar" 
                 style="width: @percent%" 
                 aria-valuenow="@Model.ExperiencePoints" 
                 aria-valuemin="0" 
                 aria-valuemax="@Model.ExpToNextLevel">
                @Model.ExperiencePoints / @Model.ExpToNextLevel EXP
            </div>
        </div>
    </div>
    <div class="mt-4 text-center">
        <a asp-area="Identity" asp-page="/Account/Manage/Index" class="btn btn-primary btn-lg">
            <i class="fas fa-cog me-2"></i>Configura√ß√µes da Conta
        </a>
    </div>
</div>



<h2>üèÜ Badges Conquistados (@Model.AchievedBadges.Count())</h2>

@if (!Model.AchievedBadges.Any())
{
    <div class="alert alert-info">
        Voc√™ ainda n√£o conquistou nenhum badge. Crie receitas e interaja para desbloquear seu primeiro!
    </div>
}
else
{
    <div class="row row-cols-1 row-cols-md-4 g-4">
        @foreach (var userBadge in Model.AchievedBadges)
        {
            <div class="col">
                <div class="card h-100 text-center shadow-sm border-0">
                    <div class="card-body">
                        <i class="@userBadge.Badge!.IconClass fa-4x mb-3" style="color: gold;"></i>
                        
                        <h5 class="card-title">@userBadge.Badge.Name</h5>
                        <p class="card-text text-muted small">@userBadge.Badge.Description</p>
                        <small class="text-secondary">Conquistado em: @userBadge.DateAchieved.ToString("dd/MM/yyyy")</small>
                    </div>
                </div>
            </div>
        }
    </div>
}